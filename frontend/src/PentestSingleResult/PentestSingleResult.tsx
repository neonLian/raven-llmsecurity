import { useState } from 'react';
import { Box, Text, Textarea, Stack, Collapse } from '@mantine/core';
import styles from './PentestSingleResult.module.css';

interface PentestSingleResultProps {
  testPassed: boolean;
  testName: string;
  adversarialPrompt: string;
  targetResponse: string;
}

export const PentestSingleResult = ({ testPassed, testName, adversarialPrompt, targetResponse }: PentestSingleResultProps) => {
  const [opened, setOpened] = useState(false);

  const backgroundColor = testPassed ? '#bdffd7' : '#ffe3e0';
  const iconColor = testPassed ? '#008c4f' : '#f44336';
  const iconSymbol = testPassed ? '✓' : '⚠';

  return (
    <Box
      p="md"
      className={styles.pentestResultBox}
      style={{
        backgroundColor,
        borderRadius: '8px',
        // border: `2px solid ${testPassed ? '#4caf50' : '#f44336'}`,
        cursor: 'pointer'
      }}
      onClick={() => setOpened(!opened)}
    >
      <Box style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
        <Box style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
          <Text size="lg" style={{ color: iconColor, fontWeight: 'bold' }}>
            {iconSymbol}
          </Text>
          <Text size="xl">
            {testPassed ? 'Passed' : 'Failed'} - {testName}
          </Text>
        </Box>
        <Text size="lg" style={{ 
          transform: opened ? 'rotate(180deg)' : 'rotate(0deg)', 
          transition: 'transform 0.2s ease',
          color: '#666'
        }}>
          ▼
        </Text>
      </Box>
      
      <Collapse in={opened}>
        <Stack gap="md" mt="md">
          <div>
            <Text size="md" mb="xs">Adversarial Prompt</Text>
            <Textarea
              value={adversarialPrompt}
              readOnly
              autosize
              minRows={2}
              maxRows={6}
            />
          </div>
          <div>
            <Text size="md" mb="xs">Target Response</Text>
            <Textarea
              value={targetResponse}
              readOnly
              autosize
              minRows={2}
              maxRows={6}
            />
          </div>
        </Stack>
      </Collapse>
    </Box>
  );
};

export default PentestSingleResult;
